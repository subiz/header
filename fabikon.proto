syntax = "proto3";

package fabikon;

option go_package = "github.com/subiz/header/fabikon";

message FacebookDataset {
	string account_id = 1;
	string page_id = 3;
	string id = 4;
}

message MetaBusiness {
	string id = 3;
	string name = 4;
}

message FacebookPage {
	string account_id = 1;
	string id = 2;
	int64 created = 3;
	string picture_url = 4;
	string name = 5;
	string original_access_token = 8;
	string access_token = 6;
	int64 updated = 7;
	int64 last_facebook_hook = 9;

	// optional string state = 8; // activated || deleted || failed
	// optional int64 last_messenger_inbox = 10; // ms

	string linked_page_id = 11; // instagram <-> facebook
	bool is_instagram = 12;
	InstagramUser instagram_account = 13;

	int64 last_success_request_at = 14;
	int64 last_failed_request_at = 15;

	int64 last_message_sent_success_at = 16;
	int64 last_message_sent_failed_at = 17;

	string token_status = 19; // '' || failed
	int64 token_status_updated = 20;
	string token_scope = 29; // empty=page, business, ads
	int64 token_updated = 30;

	string last_failed_url = 21;
	string last_failed_body = 22;
	// optional string integration_link_status = 23; // active, failed // remove

	int64 last_conversion_synced = 24;
	int64 sync_conversion_disabled = 25; // replicated of integration.sync_conversation_disabled

	string dataset_id = 28;
	bool is_business = 32;

	string system_user_token = 33;

	string state = 34; // replicated of integration.state
	int64 comment_disabled = 35; // replicated of integration.comment_disabled
	int64 last_sync_from_convo = 36;

	MetaBusiness business = 37;
	int64 last_sync = 38;

}

message WeeklyOperatingHour {
	string day_of_week = 4; // MONDAY
	string open_time = 5; // 0900
	string close_time = 6; // 1700
}

message CallHours {
	string timezone_id = 5; // America/Los_Angeles
	repeated WeeklyOperatingHour weekly_operating_hours = 6;
}

message CallSetting {
	CallHours call_hours = 5;
	bool audio_enabled = 6;
	bool icon_enabled = 7;
	string ring_target = 8;//	META , PARTNERS
	string call_routing = 9; // PARTNERS
}

message CallMetric {
	string platform = 4;// "messenger",
	string call_id = 5; // c_M5YPhGE5jm0L_PMQdScLlYJlR7tU_f0rgXinCqnTQ
	string end_call_reason = 6; // "Hangup_Call"
	string end_call_subreason = 7;// "Conversation was finished"
	string call_ended_time = 8;//	123456,
	string first_audio_packet_received_time = 9; // : 12345,
	/*"audio_stats": {
		"jitter_sec": 0.01,
		"packets_lost": 0,
		"packets_received": 1000,
		"round_trip_time_sec": 10.5,
		"jitter_buffer_delay_sec": 4000.5
		"concealed_samples": 2000,
		"silent_concealed_samples": 16000,
		"total_samples_duration_sec": 316.5
		},*/
}

message FbWebhookEvent {
	string object = 2; // instagram, page
	repeated FbEntry entry = 3;
}

message FbEntry {
	string id = 3;
	int64 time = 5;
	repeated FbMessaging messaging = 6;
	repeated FbChange changes = 7;
	repeated FbMessaging standby = 8;
	repeated FbCall calls = 9;
}

message FbCall {
	string id = 4; // "c_M5YPhGE5jm0L_PMQdScLlYJlR7tU_f0rgXiTQ"
	string to = 5;// "106378625516323",
	string from = 6; // "5275811702471834",
	string event = 7; //	"connect",
	int64 timestamp = 8; //	1671644824,
	string call_direction = 9; //	"[business_initiated|user_initiated]",
}

message FbChange {
	string field = 2; // feed, comments
	FbChangeValue value = 3;
}

message FbFrom {
	string id = 1;
	string from = 2;
	string username = 3;
}

message FbChangeValue {
	int64 edited_time = 3;
	FbFrom from = 4;
	FbPagePost post = 5;
	bool is_hidden = 6;
	string link = 7;
	string message = 8;
	string photo = 9;
	repeated string photos = 10;
	string post_id = 11;
	string story = 12;
	string title = 13;
	string video = 14;
	// optional string video_flag_reason = 15;
	string action = 16;
	string album_id = 17;
	string comment_id = 18;
	int64 created_time = 19;
	string event_id = 20;
	string item = 21;
	string open_graph_story_id = 22;
	string parent_id = 23;
	string photo_id = 24;
	string reaction_type = 25;
	int32 published = 26;
	string recipient_id = 27;
	string share_id = 28;
	string verb = 29; // remove
	string video_id = 30;
	IgMedia media = 31;
	string id = 32;
	string text = 33;
	string media_id = 34;
	FbChangeUser user = 35; // https://developers.facebook.com/docs/messenger-platform/identity/custom-labels/?locale=vi_VN
	FbCustomLabel label = 36;

	// leadgen
	string leadgen_id = 40;
	string page_id = 41;
	string form_id = 42;
	string adgroup_id = 43;
	string ad_id = 44;
}

message FbCustomLabel {
	string id = 4;
	string page_label_name = 5;
}

message FbChangeUser {
	string id = 4;
}

message IgMedia {
	string id = 3;
	string media_product_type = 4;
}

message FbPagePost {
	string status_type = 2;
	bool is_published = 3;
	string updated_time = 4;
	string permalink_url = 5;
	string promotion_status = 6;
	string id = 7;
}

message FbMessaging {
	FbSender sender = 2;
	FbRecipient recipient = 3;
	int64 timestamp = 4;
	FbMessage message = 5;
	FbDelivery delivery = 6;
	string message_type = 7;
	string sender_action = 8; // typing_on, typing_off, mark_seen
	FbRead read = 9;
	FbPostback postback = 10;
	FbReferral referral = 11;
	string tag = 12; // HUMAN_AGENT
	IgReaction reaction = 13;
	FbMessageEdit message_edit = 14;
}

message FbMessageEdit {
	string mid = 4;
	string text = 5;
	int64 num_edit = 6;
}

message IgReaction {
	string mid = 5;
	string action = 6;
	string reaction = 7;
	string emoji = 8;
}

message FbPostback {
	string payload = 2;
	FbReferral referral = 3;
	string title = 4;
	string mid = 5;
}

message AdsContextData {
	string photo_url = 5;
	string post_id = 6;
	string ad_title = 7;
	string video_url = 8;
	string product_id = 9;
}

message FbReferral {
	string ref = 2;
	string source = 3; // SHORTLINK, ADS
	string type = 4; // OPEN_THREAD
	AdsContextData ads_context_data = 5;
	string ad_id = 6;
	string referer_uri = 7;
	bool is_guest_user = 8;
	FbProduct product = 9;
}

message FbMessage {
	string mid = 2;
	string text = 3;
	repeated FbAttachment attachments = 4;
	FbRead read = 5;
	FbAttachment attachment = 6;
	bool is_echo = 7;
	int64 app_id = 8;
	string metadata = 9;
	repeated QuickReply quick_replies = 10;
	QuickReply quick_reply = 11; // response from fb
	string is_supported = 12;
	bool is_deleted = 13;
	ReplyTo reply_to = 14;

	// optional FbMessageRef referral = 15;
	FbReferral referral = 16;
}

message ReplyTo {
	string mid = 4;
	FbReplyStory story = 5;
}

message FbReplyStory {
	string url = 5;
	string id = 6;
}

message QuickReply {
	string content_type = 2; // text
	string title = 3;
	string payload = 4;
	string image_url = 5;
}

message FbSender {
	string id = 2;
	string user_ref = 3;
}

message FbRecipient {
	string id = 2;

	// https://developers.facebook.com/docs/messenger-platform/discovery/private-replies
	string post_id = 3;
	string comment_id = 4;

	string user_ref = 5;
}

message FbAction {
	string type = 2;
	string url = 3;
}

message FbAttachment {
	string type = 2; // template, fallback
	FbPayload payload = 3;
	string title = 4;
	string URL = 5;
}

message Summary {
	float subtotal = 2;
	float shipping_cost = 3;
	float total_tax = 4;
	float total_cost = 5;
}

message Adjustment {
	string name = 2;
	float amount = 3;
}

message Address {
	string street_1 = 2;
	string street_2 = 3;
	string city = 4;
	string postal_code = 5;
	string state = 6;
	string country = 7;
}

message GenericElement {
	string title = 2;
	string item_url = 3;
	string image_url = 4;
	string subtitle = 5;
	Button default_action = 6;
	string id = 7; // fbproduct id
	repeated Button buttons = 8;
	int64 quantity = 9;
	string currency = 10;
	float price = 11;
}

message FbPayload {
	string url = 2;
	bool is_reuseable = 3;
	string template_type = 4;
	bool sharable = 5;
	repeated GenericElement elements = 6;
	string text = 7; // for call btn
	repeated Button buttons = 8;

	Address address = 10;
	Summary summary = 11;
	repeated Adjustment adjustments = 12;

	string recipient_name = 13;
	string order_number = 14;
	string currency = 15;
	string payment_method = 16;
	string order_url = 17;
	// google.protobuf.Any timestamp = 18; // sometime its a string, sometime its a number https://developers.facebook.com/docs/messenger-platform/reference/templates/receipt
	FbProducts product = 19;

	string title = 20;
	// optional string sticker_id = 21;
	// optional string reel_video_id = 21;
}

message FbProducts {
	repeated FbProduct elements = 3;
}

message FbProduct {
	string id = 3;
	string retailer_id = 4;
	string image_url = 5;
	string title = 6;
	string subtitle = 7;
}

message Button {
	string type = 2; // web_url, postback, audio_call
	string title = 3;
	string payload = 4;

	string url = 5;
	string webview_height_ratio = 6; // <compact|tall|full>
	bool messenger_extensions = 7; // <true|false>
	string fallback_url = 8; //<URL_TO_FALLBACK_TO>"
	string webview_share_button = 9;

	int64 expires_in_days = 10; // 5
}

message FbRead {
	int64 watermark = 2;
	int32 seq = 3;
}

message FbDelivery {
	repeated string mids = 2;
	int64 watermark = 3;
	optional int32 seq = 4;
}

message FbSendResponse {
	string recipient_id = 2;
	string message_id = 3;
}

message Conversation {
	string account_id = 2;
	string id = 3;
	string page_id = 4;
	int64 created	= 5;
	string fbuserid = 6;
	string sbuserid = 7;
}

message FbPagePicture {
	FbPagePictureData data = 2;
}

message FbPagePictureData {
	string url = 2;
}

message FbPageEntry {
	string name = 2;
	FbPagePicture picture = 3;
	string id = 5;
	string access_token = 6;
	InstagramUser instagram_business_account = 7;
	MetaBusiness business = 8;
}

message FbCursors {
	string before = 2;
	string after = 3;
}

message FbPaging {
	FbCursors cursors = 2;
	string next = 3;
}

message FbPageRet {
	repeated FbPageEntry data = 2;
	FbPaging paging = 3;
}

message FbProfilePicData {
	int64 height = 2;
	int64 width = 3;
	bool is_silhouette = 4;
	string url = 5;
}

message FbProfilePic {
	FbProfilePicData Data = 2;
}

message FacebookUser {
	string first_name = 2;
	string middle_name = 3;
	string last_name = 4;
	string profile_pic = 5;
	string locale = 6;
	float timezone = 7;
	string gender = 8;
	FbProfilePic picture = 9;
	string email = 10;
	string name = 11;
}

message FacebookGuestUser {
	string id = 2;
	string name = 3;
	string picture = 9;
}

message InstagramUser {
	string id = 4;
	string username = 5;
	string profile_picture_url = 6;
	string name = 7;
	int64 ig_id = 8;
	int64 followers_count = 9;
	int64 follows_count = 10;
	int64 media_count = 11;
	string website = 12;

	bool is_verified_user = 13;
	bool is_user_follow_business = 14;
	bool is_business_follow_user = 15;
	string profile_pic = 16;
}

message Fb2SbEvent {
	string fbmid = 2;
	string account_id = 3;
	string conversation_id = 4;
	string sbmid = 5;
	string page_id = 6;
	int32 attachment_index = 7; // subiz
}

message LongLivedAccessToken {
	string access_token = 2;
	string token_type = 3;
	int32 expires_in = 5;
}

message SubscribeRet {
	bool success = 2;
}

message SubscribeAppRequest {
	repeated string subscribed_fields = 2;
}

message Error {
	int32 code = 3;
	int32 error_subcode = 4;
	string fbtrace_id = 5;
	string message = 6;
	string type = 7;
}

message FbResponse {
	Error error = 2;
}

message FbProductItem {
	string id = 3;
	string image_url = 4;
	string name = 5;
	string price = 6;
	string url = 7;
}

message FbPage {
	string id = 3; // pageid
	FbConversations conversations = 4;
}

message FbConversations {
	Error error = 1;
	repeated FbConversation data = 3;
	FbPaging paging = 4;
}

message FbLeads {
	Error error = 1;
	repeated FbLead data = 3;
	FbPaging paging = 4;
}

message FbFieldData {
	string name = 3;
	repeated string values = 4;
}

message FbLead {
	string created_time = 10;
	string id = 11;
	string ad_id = 12;
	string form_id = 13;
	repeated FbFieldData field_data = 14;
}

message FbConversation {
	string id = 2;
	string link = 3;

	string updated_time = 5;
	int64 message_count = 6;

	FbProfiles participants = 7;
	FbProfiles senders = 8;

	bool can_reply = 9;
	bool is_subscribed = 10;
}

message FbProfiles {
	Error error = 1;
	repeated FbProfile data = 2;
	FbPaging paging = 4;
}

message FbProfileData {
	repeated FbProfile data = 3;
}

message FbProfile {
	string name = 3;
	string email = 4;
	string id = 5;
}

message FbConversationMessageAttachemnts {
	Error error = 1;
	repeated FbConversationMessageAttachment data = 2;
	FbPaging paging = 4;
}

message FbConversationMessageAttachment {
	string id = 3;
	string mime_type = 4;
	string name = 5;
	int64 size = 6;
	string file_url = 7;
	FbImageData image_data = 8;
}

message FbImageData {
	int64 width = 2;
	int64 height = 3;
	int64 max_width = 4;
	int64 max_height = 5;
	string url = 6;
	string preview_url = 7;
	int64 image_type = 8;
	bool render_as_sticker = 9;
}

message FbConversationMessages {
	Error error = 1;
	repeated FbConversationMessage data = 2;
	FbPaging paging = 4;
}

message FbConversationMessage {
	string created_time = 2;
	FbProfile from = 3;
	string id = 4;
	string message = 5;
	FbProfileData to = 6;
	FbConversationMessageAttachemnts attachments = 7;
}

message FacebookAdsFlow {
	string id = 5;
	string name = 6;
	FbMessage welcome_message = 7;
	repeated string eligible_platforms = 8; //  messenger,instagram
	bool is_used_in_ad = 10; // fb
	string last_update_time = 11; // fb
}
